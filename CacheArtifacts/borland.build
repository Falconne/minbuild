<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003"
         DefaultTargets="DoBorlandBuild">
    
    <UsingTask TaskName="MinBuild.Borland.CheckCompileCacheBorland"
               AssemblyFile="$(MSBuildThisFileDirectory)CacheArtifacts.dll" />

    <UsingTask TaskName="MinBuild.Borland.CacheArtifactsBorland"
               AssemblyFile="$(MSBuildThisFileDirectory)CacheArtifacts.dll" />


    <PropertyGroup>
        <BranchVersion Condition=" '$(BranchVersion)' == '' ">0</BranchVersion>
        <CacheRoot Condition=" '$(CacheRoot)' == '' ">c:\temp\minbuild</CacheRoot>
        <ShowRecompileReason Condition=" '$(ShowRecompileReason)' == '' ">true</ShowRecompileReason>
        <ShowContentHashes Condition=" '$(ShowContentHashes)' == '' ">false</ShowContentHashes>
        <AlwaysRestoreCache Condition=" '$(AlwaysRestoreCache)' == '' ">false</AlwaysRestoreCache>
        <SkipCompile>false</SkipCompile>
    </PropertyGroup>

    <Target Name="DoBorlandBuild">
        <CheckCompileCacheBorland 
            Makefile="$(Makefile)"
            ProjectName="$(ProjectName)"
            BuildConfig="Debug"
            CacheRoot="$(CacheRoot)"
            ShowRecompileReason="$(ShowRecompileReason)"
            ShowContentHashes="$(ShowContentHashes)"
            AlwaysRestoreCache="$(AlwaysRestoreCache)"
            BranchVersion="$(BranchVersion)"
            WorkDir="$(WorkDir)"
            >
            <Output TaskParameter="InputHash" PropertyName="InputHash"/>
            <Output TaskParameter="RestoreSuccessful" PropertyName="SkipCompile"/>
        </CheckCompileCacheBorland>
        
        <Exec Condition="'$(SkipCompile)' != 'true'"
              WorkingDirectory="$(WorkDir)"
              Command="'$(bcb6)' -f'$(Makefile)'"/>

        <CacheArtifactsBorland Condition="'$(SkipCompile)' != 'true'"
                               InputHash="$(InputHash)"
                               Makefile="$(Makefile)"
                               ProjectName="$(ProjectName)"
                               BuildConfig="Debug"
                               CacheRoot="$(CacheRoot)"
                               ShowRecompileReason="$(ShowRecompileReason)"
                               ShowContentHashes="$(ShowContentHashes)"
                               AlwaysRestoreCache="$(AlwaysRestoreCache)"
                               BranchVersion="$(BranchVersion)"
                               WorkDir="$(WorkDir)"
                               />
        
    </Target>
</Project>
